Light Theme gated by Settings → “Light”

Goal: Implement a Light theme exactly as in my canvas component, but do not enable it automatically. The app must default to Dark and only switch to Light when the user clicks the “Light” button on the Settings tab. Persist the choice across reloads.

Constraints

Stack: Next.js + Tailwind.

Default theme: dark.

The only control that can change theme is Settings → Theme (no header toggle).

Store preference in localStorage.theme and reflect it by toggling document.documentElement.classList.

1) Tailwind + tokens (same as before)

Keep the token approach (CSS variables) and the color values from the previous prompt.

darkMode: ["class"] in tailwind.config.ts.

:root{...} and .dark{...} tokens in globals.css (unchanged).

Important: set initial HTML class to dark on the server to avoid a flash of incorrect theme. In app/layout.tsx add className="dark" on <html>.

// app/layout.tsx
export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className="dark">
      <body>{children}</body>
    </html>
  );
}

2) ThemeProvider (no auto-switch; hydrate from storage only)

Same provider as before but:

On first load, if no saved value exists, keep dark.

Do not render any header toggle; theme changes only via Settings.

"use client";
import { createContext, useContext, useEffect, useState } from "react";

type Theme = "light" | "dark";
const ThemeCtx = createContext<{theme: Theme; setTheme: (t: Theme)=>void}>({theme:"dark", setTheme: ()=>{}});

export function ThemeProvider({ children }: { children: React.ReactNode }) {
  const [theme, setTheme] = useState<Theme>("dark");

  useEffect(() => {
    const stored = (localStorage.getItem("theme") as Theme) || "dark";
    setTheme(stored);
    document.documentElement.classList.toggle("dark", stored === "dark");
  }, []);

  useEffect(() => {
    localStorage.setItem("theme", theme);
    document.documentElement.classList.toggle("dark", theme === "dark");
  }, [theme]);

  return <ThemeCtx.Provider value={{ theme, setTheme }}>{children}</ThemeCtx.Provider>;
}
export const useTheme = () => useContext(ThemeCtx);


Wrap the app:

// app/layout.tsx
import { ThemeProvider } from "@/components/theme/ThemeProvider";
export default function RootLayout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en" className="dark">
      <body>
        <ThemeProvider>{children}</ThemeProvider>
      </body>
    </html>
  );
}

3) Settings tab — the only place to switch themes

Create/modify app/settings/page.tsx (or pages/settings.tsx) to show two buttons. Only clicking Light enables the Light theme. Add data-testid hooks.

"use client";
import { useTheme } from "@/components/theme/ThemeProvider";

export default function SettingsPage() {
  const { theme, setTheme } = useTheme();

  return (
    <div className="mx-auto max-w-3xl px-6 py-8">
      <h1 className="text-2xl font-bold text-text">Settings</h1>

      <section className="mt-6 rounded-2xl border border-border bg-surface p-5 shadow-card">
        <h2 className="text-sm font-semibold text-text">Theme</h2>
        <p className="mt-1 text-sm text-muted">Choose how Opus looks.</p>

        <div className="mt-4 flex gap-3">
          <button
            data-testid="theme-light"
            onClick={() => setTheme("light")}
            className={`rounded-xl border px-4 py-2 text-sm font-medium shadow-sm ${
              theme === "light"
                ? "border-violet-500"
                : "border-border"
            }`}
            aria-pressed={theme === "light"}
          >
            Light
          </button>

          <button
            data-testid="theme-dark"
            onClick={() => setTheme("dark")}
            className={`rounded-xl border px-4 py-2 text-sm font-medium shadow-sm ${
              theme === "dark"
                ? "border-violet-500"
                : "border-border"
            }`}
            aria-pressed={theme === "dark"}
          >
            Dark
          </button>
        </div>
      </section>
    </div>
  );
}


Remove or hide any existing header theme toggle component. If one exists, either delete it or feature-flag it off.

4) Overview UI uses tokens and looks great in both themes

Use the LightOverviewPreview component from my canvas (same structure).

Replace hardcoded slate/white classes with tokenized ones where applicable:

bg-white → bg-surface

border-slate-200 → border-border

text-slate-900 → text-text

text-slate-500/600 → text-muted

Keep the gradient progress bar and bullet colors.

Route:

// app/(dashboard)/overview/page.tsx
import LightOverview from "@/components/overview/LightOverviewPreview";
export default function OverviewPage() { return <LightOverview />; }

5) QA / Acceptance

 App starts in Dark (no prior preference).

 Navigating to Settings → Theme → Light switches to Light immediately and persists on refresh.

 Returning to Settings → Dark switches back and persists.

 No other UI can change theme.

 Overview page matches the light design from canvas and maintains AA contrast in both themes.

 No FOUC: html has class="dark" by default, and hydration applies saved preference quickly.

Deliverables

tailwind.config.ts, globals.css with tokens (unchanged from prior).

components/theme/ThemeProvider.tsx (hydration + persistence).

app/settings/page.tsx with Light/Dark buttons (only place to switch).

Updated Overview to use tokenized classes and the canvas design.

Removed any stray toggles outside Settings.